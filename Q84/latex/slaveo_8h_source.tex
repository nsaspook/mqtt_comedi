\doxysection{slaveo.\+h}
\hypertarget{slaveo_8h_source}{}\label{slaveo_8h_source}\index{bmc\_slave.X/slaveo.h@{bmc\_slave.X/slaveo.h}}
\mbox{\hyperlink{slaveo_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00001}00001\ }
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00007}00007\ }
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00008}00008\ \textcolor{preprocessor}{\#ifndef\ SLAVEO\_H}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00009}00009\ \textcolor{preprocessor}{\#define\ SLAVEO\_H}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00010}00010\ }
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00011}00011\ \textcolor{preprocessor}{\#ifdef\ \ \_\_cplusplus}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00012}00012\ \textcolor{keyword}{extern}\ \textcolor{stringliteral}{"{}C"{}}\ \{}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00013}00013\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00014}00014\ \textcolor{preprocessor}{\#include\ <xc.h>}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00015}00015\ \textcolor{preprocessor}{\#include\ <stdlib.h>}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00016}00016\ \textcolor{preprocessor}{\#include\ <stdint.h>}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00017}00017\ \textcolor{preprocessor}{\#include\ <stdbool.h>}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00018}00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{mconfig_8h}{mconfig.h}}"{}}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00019}00019\ \textcolor{preprocessor}{\#include\ "{}mcc\_generated\_files/tmr0.h"{}}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00020}00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eadog_8h}{eadog.h}}"{}}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00021}00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{timers_8h}{timers.h}}"{}}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00022}00022\ }
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00023}00023\ \textcolor{preprocessor}{\#define\ SLAVEO\_DRIVER\ "{}V0.8"{}}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00024}00024\ }
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00025}00025\ \textcolor{preprocessor}{\#define\ SLAVE\_DEBUG}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00026}00026\ }
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00027}00027\ \ \ \ \ \textcolor{comment}{/*\ PIC\ Slave\ commands\ */}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00028}00028\ \textcolor{preprocessor}{\#define\ CMD\_ZERO\ \ \ \ \ \ \ \ 0b00000000}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00029}00029\ \textcolor{preprocessor}{\#define\ CMD\_ADC\_GO\ \ \ \ \ \ 0b10000000\ \ }\textcolor{comment}{//\ Read\ ADC\ data}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00030}00030\ \textcolor{preprocessor}{\#define\ CMD\_DAC\_GO\ \ \ \ \ \ 0x90\ \ \ \ \ \ \ \ }\textcolor{comment}{//\ Set\ DAC\ data}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00031}00031\ \textcolor{preprocessor}{\#define\ CMD\_PORT\_GO\ \ \ \ \ 0xa0\ \ \ \ \ \ \ \ }\textcolor{comment}{//\ Set\ DO\ data}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00032}00032\ \textcolor{preprocessor}{\#define\ CMD\_CHAR\_GO\ \ \ \ \ 0b10110000}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00033}00033\ \textcolor{preprocessor}{\#define\ CMD\_ADC\_DATA\ \ \ \ 0b11000000}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00034}00034\ \textcolor{preprocessor}{\#define\ CMD\_PORT\_DATA\ \ \ 0b11010000}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00035}00035\ \textcolor{preprocessor}{\#define\ CMD\_CHAR\_DATA\ \ \ 0b11100000\ \ }\textcolor{comment}{//\ Send\ serial\ TX\ buffer}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00036}00036\ \textcolor{preprocessor}{\#define\ CMD\_PORT\_GET\ \ \ \ 0b11110000\ \ }\textcolor{comment}{//\ Read\ DI\ data}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00037}00037\ \textcolor{preprocessor}{\#define\ CMD\_CHAR\_GET\ \ \ \ 0b00010000\ \ }\textcolor{comment}{//\ Get\ serial\ RX\ buffer}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00038}00038\ \textcolor{preprocessor}{\#define\ CMD\_DUMMY\_CFG\ \ \ 0b01000000\ \ }\textcolor{comment}{//\ stuff\ config\ data\ in\ SPI\ buffer}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00039}00039\ \textcolor{preprocessor}{\#define\ CMD\_DEAD\ \ \ \ \ \ \ \ 0b11111111\ \ \ \ \ \ }\textcolor{comment}{//\ This\ is\ usually\ a\ bad\ response}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00040}00040\ }
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00041}00041\ \textcolor{preprocessor}{\#define\ CHECKBYTE\ \ \ \ \ \ \ 0x57}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00042}00042\ }
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00043}00043\ \textcolor{preprocessor}{\#define\ CMD\_DUMMY\ \ \ \ \ \ \ 0b01100111\ \ }\textcolor{comment}{/*\ 7\ channels\ 4.096\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00044}00044\ \textcolor{preprocessor}{\#define\ NUM\_AI\_CHAN\ \ \ \ \ 15}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00045}00045\ \textcolor{preprocessor}{\#define\ AI\_BUFFER\_NUM\ \ \ 0x40}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00046}00046\ \textcolor{preprocessor}{\#define\ AI\_CHAN\_FIX\ 5}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00047}00047\ }
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00048}00048\ \textcolor{preprocessor}{\#define\ NUM\_AO\_CHAN\ \ \ \ \ 1}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00049}00049\ \textcolor{preprocessor}{\#define\ AO\_BUFFER\_NUM\ \ \ 0x40}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00050}00050\ }
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00051}00051\ \textcolor{preprocessor}{\#define\ SPI\_BUFFER\_LEN\ \ 10}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00052}00052\ \textcolor{preprocessor}{\#define\ PACKET\_BUF\_SIZ\ \ 16}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00053}00053\ \textcolor{preprocessor}{\#define\ RSTRING\_BUF\_SIZ\ 81}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00054}00054\ }
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00055}00055\ \textcolor{preprocessor}{\#define\ HI\_NIBBLE\ \ \ \ \ \ \ 0xf0}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00056}00056\ \textcolor{preprocessor}{\#define\ LO\_NIBBLE\ \ \ \ \ \ \ 0x0f}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00057}00057\ \textcolor{preprocessor}{\#define\ ADC\_SWAP\_MASK\ \ \ 0b01000000}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00058}00058\ \textcolor{preprocessor}{\#define\ UART\_DUMMY\_MASK\ 0b01000000}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00059}00059\ }
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00060}00060\ \textcolor{preprocessor}{\#define\ PORT\_GET\_BYTES\ \ 7}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00061}00061\ \textcolor{preprocessor}{\#define\ CHAR\_GET\_BYTES\ \ 7}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00062}00062\ \textcolor{preprocessor}{\#define\ CFG\_GET\_BYTES\ \ \ 7}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00063}00063\ \textcolor{preprocessor}{\#define\ ADC\_GET\_BYTES\ \ \ 7}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00064}00064\ \textcolor{preprocessor}{\#define\ PORT\_GO\_BYTES\ \ \ 7}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00065}00065\ \textcolor{preprocessor}{\#define\ CHAR\_GO\_BYTES\ \ \ 7}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00066}00066\ \textcolor{preprocessor}{\#define\ DAC\_GO\_BYTES\ \ \ \ 7}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00067}00067\ }
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00068}\mbox{\hyperlink{structspi__link__type__ss}{00068}}\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structspi__link__type__ss}{spi\_link\_type\_ss}}\ \{\ \textcolor{comment}{//\ internal\ state\ table}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00069}00069\ \ \ \ \ \ \ \ \ uint8\_t\ SPI\_DATA\ :\ 1;}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00070}00070\ \ \ \ \ \ \ \ \ uint8\_t\ ADC\_DATA\ :\ 1;}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00071}00071\ \ \ \ \ \ \ \ \ uint8\_t\ PORT\_DATA\ :\ 1;}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00072}00072\ \ \ \ \ \ \ \ \ uint8\_t\ CHAR\_DATA\ :\ 1;}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00073}00073\ \ \ \ \ \ \ \ \ uint8\_t\ REMOTE\_LINK\ :\ 1;}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00074}00074\ \ \ \ \ \ \ \ \ uint8\_t\ REMOTE\_DATA\_DONE\ :\ 1;}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00075}00075\ \ \ \ \ \ \ \ \ uint8\_t\ LOW\_BITS\ :\ 1;}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00076}00076\ \ \ \ \ \ \ \ \ uint8\_t\ ADC\_RUN\ :\ 1;}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00077}00077\ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00078}00078\ }
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00079}\mbox{\hyperlink{structspi__stat__type__ss}{00079}}\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structspi__stat__type__ss}{spi\_stat\_type\_ss}}\ \{}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00080}00080\ \ \ \ \ \ \ \ \ \textcolor{keyword}{volatile}\ uint32\_t\ adc\_count,\ dac\_count,}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00081}00081\ \ \ \ \ \ \ \ \ port\_count,\ port\_error\_count,\ port\_data\_count,\ zombie\_count,}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00082}00082\ \ \ \ \ \ \ \ \ char\_count,\ char\_error\_count,\ rxof\_bit,\ txdone\_bit,\ txuf\_bit,}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00083}00083\ \ \ \ \ \ \ \ \ slave\_int\_count,\ last\_slave\_int\_count,\ slave\_tx\_count,}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00084}00084\ \ \ \ \ \ \ \ \ comm\_count,\ idle\_count,\ spi\_error\_count,\ spi\_noerror\_count;}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00085}00085\ \ \ \ \ \ \ \ \ \textcolor{keyword}{volatile}\ uint8\_t\ comm\_ok,\ raw\_index,\ daq\_conf;}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00086}00086\ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00087}00087\ }
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00088}\mbox{\hyperlink{structserial__buffer__type__ss}{00088}}\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structserial__buffer__type__ss}{serial\_buffer\_type\_ss}}\ \{}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00089}00089\ \ \ \ \ \ \ \ \ \textcolor{keyword}{volatile}\ uint8\_t\ data[PACKET\_BUF\_SIZ],\ r\_string[RSTRING\_BUF\_SIZ],\ adcl,\ adc2,\ adch,\ command,\ raw\_index,\ r\_string\_index,\ r\_string\_chan;}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00090}00090\ \ \ \ \ \ \ \ \ \textcolor{keyword}{volatile}\ uint32\_t\ place;}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00091}00091\ \ \ \ \ \ \ \ \ \textcolor{keyword}{volatile}\ \textcolor{keywordtype}{bool}\ make\_value,\ get\_value,\ dac\_value,\ adc\_value,\ cfg\_value,\ cmake\_value,\ cget\_value;}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00092}00092\ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00093}00093\ }
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00094}00094\ \ \ \ \ \textcolor{keyword}{enum}\ daqbmc\_packet\_index\ \{}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00095}00095\ \ \ \ \ \ \ \ \ BMC\_CMD\ =\ 0,}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00096}00096\ \ \ \ \ \ \ \ \ BMC\_D0,}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00097}00097\ \ \ \ \ \ \ \ \ BMC\_D1,}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00098}00098\ \ \ \ \ \ \ \ \ BMC\_D2,}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00099}00099\ \ \ \ \ \ \ \ \ BMC\_D3,}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00100}00100\ \ \ \ \ \ \ \ \ BMC\_D4,}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00101}00101\ \ \ \ \ \ \ \ \ BMC\_EXT\ =\ 6,}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00102}00102\ \ \ \ \ \ \ \ \ BMC\_CKSUM\ =\ 7,}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00103}00103\ \ \ \ \ \ \ \ \ BMC\_DUMMY,}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00104}00104\ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00105}00105\ }
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00106}00106\ \ \ \ \ \textcolor{keyword}{extern}\ \textcolor{keyword}{volatile}\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structspi__link__type__ss}{spi\_link\_type\_ss}}\ spi\_comm\_ss;}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00107}00107\ \ \ \ \ \textcolor{keyword}{extern}\ \textcolor{keyword}{volatile}\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structserial__buffer__type__ss}{serial\_buffer\_type\_ss}}\ serial\_buffer\_ss;}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00108}00108\ \ \ \ \ \textcolor{keyword}{extern}\ \textcolor{keyword}{volatile}\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structspi__stat__type__ss}{spi\_stat\_type\_ss}}\ spi\_stat\_ss,\ report\_stat\_ss;}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00109}00109\ \ \ \ \ \textcolor{keyword}{extern}\ \textcolor{keyword}{volatile}\ uint8\_t\ data\_in2,\ adc\_buffer\_ptr,\ adc\_channel,\ channel,\ upper;}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00110}00110\ \ \ \ \ \textcolor{keyword}{extern}\ \textcolor{keyword}{volatile}\ uint16\_t\ adc\_buffer[AI\_BUFFER\_NUM],\ adc\_data\_in,\ dac\_buffer[AO\_BUFFER\_NUM],\ dac\_data\_in;}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00111}00111\ \ \ \ \ \textcolor{keyword}{extern}\ \mbox{\hyperlink{structV__data}{V\_data}}\ V;}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00112}00112\ \ \ \ \ \textcolor{keyword}{volatile}\ \textcolor{keywordtype}{bool}\ failure;}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00113}00113\ \ \ \ \ \textcolor{keyword}{extern}\ \textcolor{keyword}{volatile}\ uint8\_t\ in\_buf1,\ in\_buf2,\ in\_buf3;}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00114}00114\ \ \ \ \ \textcolor{keyword}{extern}\ \textcolor{keyword}{volatile}\ uint8\_t\ tmp\_buf;}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00115}00115\ \ \ \ \ \textcolor{keyword}{extern}\ \textcolor{keyword}{volatile}\ \textcolor{keywordtype}{bool}\ r\_string\_ready;}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00116}00116\ }
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00117}00117\ \ \ \ \ \textcolor{keywordtype}{void}\ check\_slaveo(\textcolor{keywordtype}{void});}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00118}00118\ \ \ \ \ \textcolor{keywordtype}{void}\ init\_slaveo(\textcolor{keywordtype}{void});}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00119}00119\ }
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00120}00120\ \ \ \ \ \textcolor{keywordtype}{void}\ slaveo\_rx\_isr(\textcolor{keywordtype}{void});}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00121}00121\ \ \ \ \ \textcolor{keywordtype}{void}\ slaveo\_spi\_isr(\textcolor{keywordtype}{void});}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00122}00122\ \ \ \ \ \textcolor{keywordtype}{void}\ slaveo\_time\_isr(\textcolor{keywordtype}{void});}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00123}00123\ }
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00124}00124\ \textcolor{preprocessor}{\#ifdef\ \ \_\_cplusplus}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00125}00125\ \}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00126}00126\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00127}00127\ }
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00128}00128\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{/*\ SLAVEO\_H\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{\Hypertarget{slaveo_8h_source_l00129}00129\ }

\end{DoxyCode}
